% Generate 16x12 P Matrix
clear all
M = [2,2,2,1;-2,2,2,1;-2,2,-2,1;2,2,-2,1;2,-2,2,1;-2,-2,2,1;-2,-2,-2,1;2,-2,-2,1];
m= [422,323,1;178,323,1;118,483,1;482,483,1;438,73,1;162,73,1;78,117,1;522,117,1];
%% Q1.1
figure(1), plot(m(:,1),m(:,2),'o'), title('Image Points')
%% Q1.3
P=[];
for i = 1:8
    P=vertcat(P,twoRowP(M(i,:),m(i,:)))
end

P =

     2     2     2     1     0     0     0     0   844   844   844   422
     0     0     0     0     2     2     2     1   646   646   646   323


P =

     2     2     2     1     0     0     0     0   844   844   844   422
     0     0     0     0     2     2     2     1   646   646   646   323
    -2     2     2     1     0     0     0     0  -356   356   356   178
     0     0     0     0    -2     2     2     1  -646   646   646   323


P =

     2     2     2     1     0     0     0     0   844   844   844   422
     0     0     0     0     2     2     2     1   646   646   646   323
    -2     2     2     1     0     0     0     0  -356   356   356   178
     0     0     0     0    -2     2     2     1  -646   646   646   323
    -2     2    -2     1     0     0     0     0  -236   236  -236   118
     0     0     0     0    -2     2    -2     1  -966   966  -966   483


P =

     2     2     2     1     0     0     0     0   844   844   844   422
     0     0     0     0     2     2     2     1   646   646   646   323
    -2     2     2     1     0     0     0     0  -356   356   356   178
     0     0     0     0    -2     2     2     1  -646   646   646   323
    -2     2    -2     1     0     0     0     0  -236   236  -236   118
     0     0     0     0    -2     2    -2     1  -966   966  -966   483
     2     2    -2     1     0     0     0     0   964   964  -964   482
     0     0     0     0     2     2    -2     1   966   966  -966   483


P =

     2     2     2     1     0     0     0     0   844   844   844   422
     0     0     0     0     2     2     2     1   646   646   646   323
    -2     2     2     1     0     0     0     0  -356   356   356   178
     0     0     0     0    -2     2     2     1  -646   646   646   323
    -2     2    -2     1     0     0     0     0  -236   236  -236   118
     0     0     0     0    -2     2    -2     1  -966   966  -966   483
     2     2    -2     1     0     0     0     0   964   964  -964   482
     0     0     0     0     2     2    -2     1   966   966  -966   483
     2    -2     2     1     0     0     0     0   876  -876   876   438
     0     0     0     0     2    -2     2     1   146  -146   146    73


P =

     2     2     2     1     0     0     0     0   844   844   844   422
     0     0     0     0     2     2     2     1   646   646   646   323
    -2     2     2     1     0     0     0     0  -356   356   356   178
     0     0     0     0    -2     2     2     1  -646   646   646   323
    -2     2    -2     1     0     0     0     0  -236   236  -236   118
     0     0     0     0    -2     2    -2     1  -966   966  -966   483
     2     2    -2     1     0     0     0     0   964   964  -964   482
     0     0     0     0     2     2    -2     1   966   966  -966   483
     2    -2     2     1     0     0     0     0   876  -876   876   438
     0     0     0     0     2    -2     2     1   146  -146   146    73
    -2    -2     2     1     0     0     0     0  -324  -324   324   162
     0     0     0     0    -2    -2     2     1  -146  -146   146    73


P =

     2     2     2     1     0     0     0     0   844   844   844   422
     0     0     0     0     2     2     2     1   646   646   646   323
    -2     2     2     1     0     0     0     0  -356   356   356   178
     0     0     0     0    -2     2     2     1  -646   646   646   323
    -2     2    -2     1     0     0     0     0  -236   236  -236   118
     0     0     0     0    -2     2    -2     1  -966   966  -966   483
     2     2    -2     1     0     0     0     0   964   964  -964   482
     0     0     0     0     2     2    -2     1   966   966  -966   483
     2    -2     2     1     0     0     0     0   876  -876   876   438
     0     0     0     0     2    -2     2     1   146  -146   146    73
    -2    -2     2     1     0     0     0     0  -324  -324   324   162
     0     0     0     0    -2    -2     2     1  -146  -146   146    73
    -2    -2    -2     1     0     0     0     0  -156  -156  -156    78
     0     0     0     0    -2    -2    -2     1  -234  -234  -234   117


P =

  Columns 1 through 9

           2           2           2           1           0           0           0           0         844
           0           0           0           0           2           2           2           1         646
          -2           2           2           1           0           0           0           0        -356
           0           0           0           0          -2           2           2           1        -646
          -2           2          -2           1           0           0           0           0        -236
           0           0           0           0          -2           2          -2           1        -966
           2           2          -2           1           0           0           0           0         964
           0           0           0           0           2           2          -2           1         966
           2          -2           2           1           0           0           0           0         876
           0           0           0           0           2          -2           2           1         146
          -2          -2           2           1           0           0           0           0        -324
           0           0           0           0          -2          -2           2           1        -146
          -2          -2          -2           1           0           0           0           0        -156
           0           0           0           0          -2          -2          -2           1        -234
           2          -2          -2           1           0           0           0           0        1044
           0           0           0           0           2          -2          -2           1         234

  Columns 10 through 12

         844         844         422
         646         646         323
         356         356         178
         646         646         323
         236        -236         118
         966        -966         483
         964        -964         482
         966        -966         483
        -876         876         438
        -146         146          73
        -324         324         162
        -146         146          73
        -156        -156          78
        -234        -234         117
       -1044       -1044         522
        -234        -234         117

clear M
%% Q1.4
[U,S,V]=svd(P);
M(1,1:4) = V(1:4,end);
M(2,1:4) = V(5:8,end);
M(3,1:4) = V(9:12,end);
disp('Projection Matrix M')
Projection Matrix M
disp(M)
   -0.1925   -0.0283   -0.0786   -0.7346
   -0.0000   -0.2044   -0.0001   -0.6120
    0.0000    0.0001    0.0003    0.0024

%% Q1.5
[U,S,V]=svd(M);
temp=V(:,4)/V(4,4);
Euclidiean_Camera_Coord=[temp(1),temp(2),temp(3)]

Euclidiean_Camera_Coord =

   -0.0000   -2.9912   -8.2695

%% Q1.6
 M_prime= M(1:3,1:3);
 M_prime= M_prime/M_prime(3,3);
 disp('Matrix M''')
Matrix M'
 disp(M_prime)
 -734.6289 -107.8955 -299.9999
   -0.0009 -780.1442   -0.2641
    0.0000    0.3597    1.0000

 %% Q1.7
 cos_theta_x= M_prime(3,3)/sqrt(M_prime(3,3)^2+M_prime(3,2)^2);
 sin_theta_x= -M_prime(3,2)/sqrt(M_prime(3,3)^2 + M_prime(3,2)^2);
 theta_x_deg=rad2deg(acos(cos_theta_x))

theta_x_deg =

   19.7812

 R_x=[1,0,0;0,cos_theta_x,-sin_theta_x;0,sin_theta_x,cos_theta_x]

R_x =

    1.0000         0         0
         0    0.9410    0.3384
         0   -0.3384    0.9410

 N=M_prime*R_x

N =

 -734.6289    0.0000 -318.8125
   -0.0009 -734.0199 -264.2723
    0.0000         0    1.0627

%  N=N/N(3,3);
 %% Q1.8
 cos_theta_z= (N(2,2)/sqrt(N(2,1)^2+N(2,2)^2));
 sin_theta_z= -N(2,1)/sqrt(N(2,1)^2+N(2,2)^2);
 theta_z_deg= rad2deg(acos(cos_theta_z))

theta_z_deg =

  179.9999

 R_z=[cos_theta_z,-sin_theta_z,0;sin_theta_z,cos_theta_z,0;0,0,1]

R_z =

   -1.0000   -0.0000         0
    0.0000   -1.0000         0
         0         0    1.0000

%  N= N*R_z;
 %% Q1.9
 % R= R1*R2*R3
 R=R_x*eye(3)*R_z

R =

   -1.0000   -0.0000         0
    0.0000   -0.9410    0.3384
   -0.0000    0.3384    0.9410

 K= M_prime*(R);
 K = K/K(3,3)

K =

  691.2797    0.0009 -299.9999
    0.0000  690.7067 -248.6780
   -0.0000   -0.0000    1.0000

fl= (K(1,1)+K(2,2))/2;
disp('Focal length = ')
Focal length = 
disp(fl)
  690.9932

disp('Image center = ')
Image center = 
disp([K(1,3),K(2,3)])
 -299.9999 -248.6780

diary off
diary off
